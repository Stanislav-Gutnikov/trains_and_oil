# trains_and_oil
API - Симуляция логистической системы.

### Описание ###
Система симулирует движение поездов между двумя терминалами с добычей нефти и перевалочным пунктом, а также моделирует изменения остатков нефти на терминалах и перевалочном пункте. Расчет производится за заданный промежуток времени. Система работает с шагом 1 час, то есть выводит информацию о симуляции каждый час. Исходные данные система берет из внутреннего файла.

### Описание исходных данных ###
Есть 2 терминала Радужный и Звезда, где отгружают в поезда нефть, и перевалочный пункт Полярный, куда поезда выгружают транспортированную нефть. Рассматривается 2 маршрута поездов между Радужным и Полярным и между Звездой и Полярным. Пять составов поездов курсируют между Радужным и Полярным и 2 состава курсируют между Звездой и Полярным. На терминалах Радужный и Звезда есть только по одному пути, где поезда могут загружать в себя нефть, а на перевалочном пункте Полярный есть 3 пути, где поезда могут выполнять грузовую операцию. Как только на перевалочном пункте Полярный накапливается 10тыс тн нефти, то на погрузку подходит еще один состав, который грузит в себя это количество нефти и уезжает.

### Описание эндпоинтов ###

GET - в ответ на отправленный id рассчета придет файл .xls с расчетом из БД. Если рассчета с таким id нет в БД, то вернется ошибка 404 "NOT FOUND".

POST - при отправке запроса с указанным id и параметром recalc (перерассчет) = False будет начат новый рассчет системы и запись данных, полученных при рассчете в БД. Если в БД уже есть рассчет с отправленным id, то вернется ошибка 400 "BAD REQUEST". Если нужно обновить существующие данные, то следует отправить id рассчета, который уже есть в БД и указать recalc = True. Рассчет с отправленным id будет перезаписан.

DELETE - удаляет рассчет с отправленным id.

### Установка ###

Клонировать репозиторий и перейти в него в командной строке:

```
git clone https://github.com/Stanislav-Gutnikov/trains_and_oil.git
```
```
cd trains_and_oil/
```

Cоздать и активировать виртуальное окружение:

```
python -m venv venv
```
```
source venv/Scripts/activate
```

Создать файл .env с переменными из раздела "Переменные .env"


Установить зависимости из файла requirements.txt:

```
pip install -r requirements.txt
```

Создать локальную БД postgres. Переменные которые следует указывать при создании БД указаны ниже.


Сделать миграции alembic:

```
alembic upgrade head
```

Запустить проект локально:

```
uvicorn app.main:app
```

Проект будет доступен по адресу http://127.0.0.1:8000/docs


### Переменные .env ###

DB_NAME=postgres
USER=postgres
PASSWORD=postgres
HOST=localhost
PORT=5432
DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost/postgres
XLSX_FILE_PATH=C:\\Dev\\trains_and_oil\\app\\api\\get_db_data.xls
